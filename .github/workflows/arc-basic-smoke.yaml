name: ARC basic smoke

on:
  workflow_dispatch:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]
    tags:
      - 'v*.*.*'

permissions:
  contents: read

jobs:
  smoke:
    runs-on: [self-hosted, arc, k8s]
    timeout-minutes: 15

    steps:
      - name: Prints bÃ¡sicos
        run: |
          echo "Hola desde ARC ðŸ‘‹"
          echo "Evento: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "SHA: ${{ github.sha }}"
          echo "Actor: ${{ github.actor }}"
          echo "Repo: ${{ github.repository }}"
          echo "Runner name: $RUNNER_NAME"
          echo "Runner labels: $RUNNER_TRACKING_ID (interno), usa 'runs-on: arc-runner-set'"

      - name: Install AWS CLI v2
        uses: aws-actions/setup-cli@v4
        with:
          awscli-version: '2.x'

      - name: Verificar AWS CLI
        run: |
          which aws || true
          aws --version

      - name: Mensaje para PR
        if: ${{ github.event_name == 'pull_request' }}
        run: |
          echo "Este es un PR #${{ github.event.number }} desde ${{ github.head_ref }} âžœ ${{ github.base_ref }}"

      - name: Mensaje para push a main
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
        run: |
          echo "Push directo a main detectado âœ…"

      - name: Mensaje para release tag
        if: ${{ github.event_name == 'push' && startsWith(github.ref, 'refs/tags/v') }}
        run: |
          echo "Build de release para la etiqueta: ${{ github.ref_name }}"

      - name: Contexto breve
        run: |
          echo "Workspace: $GITHUB_WORKSPACE"
          echo "Runner Temp: $RUNNER_TEMP"
          echo "Runner Tool Cache: $RUNNER_TOOL_CACHE"
